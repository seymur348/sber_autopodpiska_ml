# ML-–ø—Ä–æ–µ–∫—Ç: –ü—Ä–æ–≥–Ω–æ–∑ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ¬´–°–±–µ—Ä–ê–≤—Ç–æ–ø–æ–¥–ø–∏—Å–∫–∞¬ª

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω—ã–π ML-–ø–∞–π–ø–ª–∞–π–Ω: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö Google Analytics, –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ sessions + hits, –æ—á–∏—Å—Ç–∫–∞, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ Logistic Regression –∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ FastAPI —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω-–ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

sber_autopodpiska_ml/
‚îÇ
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ sessions_prepared.pkl      ‚Äî –æ—á–∏—â–µ–Ω–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ hits_agg.pkl               ‚Äî –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ hits
‚îÇ
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ pipeline.py                ‚Äî –ø–æ–ª–Ω—ã–π –∫–æ–¥ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ model.pkl                  ‚Äî —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è ML-–º–æ–¥–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ freq_maps.pkl              ‚Äî —á–∞—Å—Ç–æ—Ç–Ω—ã–µ —Å–ª–æ–≤–∞—Ä–∏ –¥–ª—è freq-encoding
‚îÇ
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py                    ‚Äî FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ
‚îî‚îÄ‚îÄ README.md

---

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

python3 -m venv .venv
source .venv/bin/activate

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

pip install pandas scikit-learn dill fastapi uvicorn

---

## üßπ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–í –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:

‚Ä¢ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ —Å >50% –ø—Ä–æ–ø—É—Å–∫–æ–≤  
‚Ä¢ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –º–æ–¥–æ–π –∏ –Ω—É–ª—è–º–∏  
‚Ä¢ –æ–±—Ä–∞–±–æ—Ç–∫–∞ device_screen_resolution (¬´360x720¬ª ‚Üí screen_w=360, screen_h=720)  
‚Ä¢ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ–¥–∫–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (top-N)  
‚Ä¢ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ sessions –∏ hits –ø–æ session_id  
‚Ä¢ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –≤—Ä–µ–º–µ–Ω–∏ –≤–∏–∑–∏—Ç–∞ (hour, weekday, month, is_weekend)  
‚Ä¢ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ sessions_prepared.pkl  

---

## üß† Feature Engineering

–ú–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∏ –≥—Ä—É–ø–ø—ã –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:

### 1) One-Hot Encoding:
- device_category  
- utm_medium  
- geo_country  

### 2) Frequency Encoding:
- utm_source  
- utm_campaign  
- utm_adcontent  
- device_browser  
- geo_city  

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è dict —á–∞—Å—Ç–æ—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π ‚Üí freq_maps.pkl  

–≠—Ç–æ –≤–∞–∂–Ω–æ: –≤ FastAPI –Ω–æ–≤—ã–π JSON –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ä–æ–≤–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ–±—É—á–µ–Ω–∏–∏.

### 3) Numeric features:
- visit_hour, visit_weekday, visit_month  
- is_weekend  
- hits, pageviews, events  
- screen_w, screen_h  

---

## ü§ñ –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ (models/pipeline.py)

–ú–æ–¥–µ–ª—å Logistic Regression –æ–±—É—á–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ Pipeline:

‚Ä¢ ColumnTransformer ‚Üí OneHotEncoder + —á–∏—Å–ª–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ + frequency encoding  
‚Ä¢ LogisticRegression(solver="liblinear", class_weight="balanced", max_iter=1200)  
‚Ä¢ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ model.pkl + freq_maps.pkl  

–ü–æ—á–µ–º—É logistic regression?  
‚Äì –±—ã—Å—Ç—Ä–æ  
‚Äì —Å—Ç–∞–±–∏–ª—å–Ω–æ  
‚Äì —Ö–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω—ã—Ö –º–∞—Ç—Ä–∏—Ü–∞—Ö  
‚Äì –ª–µ–≥–∫–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ –ø—Ä–æ–¥–µ  

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

–ù–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ:

Accuracy ‚âà 0.80  
ROC-AUC ‚âà 0.81  

–ú–æ–¥–µ–ª—å —É–≤–µ—Ä–µ–Ω–Ω–æ —Ä–∞–∑–ª–∏—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è, –∏ —Ç–µ—Ö, –∫—Ç–æ –Ω–µ—Ç.

---

## üöÄ FastAPI —Å–µ—Ä–≤–∏—Å

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é –º–æ–¥–µ–ª—å + —á–∞—Å—Ç–æ—Ç–Ω—ã–µ —Å–ª–æ–≤–∞—Ä–∏.

–ó–∞–ø—É—Å–∫:

uvicorn main:app --reload

API –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É:

http://127.0.0.1:8000

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
- GET / ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è  
- POST /predict ‚Üí –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ  

---

## üî• –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –∫ /predict

{
  "device_category": "mobile",
  "utm_medium": "cpc",
  "geo_country": "Russia",
  "utm_source": "google",
  "utm_campaign": "promo123",
  "utm_adcontent": "banner1",
  "device_browser": "Chrome",
  "geo_city": "Moscow",
  "visit_hour": 14,
  "visit_weekday": 2,
  "visit_month": 11,
  "is_weekend": 0,
  "hits": 2,
  "pageviews": 1,
  "events": 0,
  "screen_w": 360,
  "screen_h": 720
}

---

## üì• –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

{
  "prediction": 0,
  "probability": 0.1464
}

–ì–¥–µ:
- prediction = 1 ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è  
- prediction = 0 ‚Üí –Ω–µ—Ç  
- probability ‚Üí –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏–∏  

---

## üß© –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞

‚Ä¢ –ü–æ–ª–Ω—ã–π ML-—Ü–∏–∫–ª–æ–º: –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ ‚Üí –æ–±—É—á–µ–Ω–∏–µ ‚Üí –¥–µ–ø–ª–æ–π  
‚Ä¢ –ï–¥–∏–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –æ–±—É—á–µ–Ω–∏–∏ –∏ API  
‚Ä¢ Frequency Encoding —Å–æ–≤–º–µ—Å—Ç–∏–º —Å –ø—Ä–æ–¥–∞–∫—à–Ω–æ–º –∏ –±—ã—Å—Ç—Ä—ã–π  
‚Ä¢ –ú–æ–¥–µ–ª—å –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –∏ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è (CatBoost, LightGBM)  
‚Ä¢ FastAPI –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–ª–∏–∫ –∏ –≥–æ—Ç–æ–≤ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏  

---


